
<div class="card-text">
  <h3><strong><%= @user.name %></strong>さんの進捗状況</h3>
</div>

<div class="lecture-text">
  <table class="table">
    <thead class="thead-dark">
      <tr>
        <th>社員番号</th>
        <th>メールアドレス</th>
        <th>最終更新日</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td><%= @user.employee_number %></td>
        <td><%= @user.email %></td>
        <td><%= @checked.length >= 1 ? @checked[0].created_at.strftime('%Y/%m/%d %H:%M:%S') : '完了したレクチャーはまだありません' %></td>
      </tr>
    </tbody>
  </table>
</div>

<div class="line-thin"></div>

<% i = 0 %>

<% @courses.each do |course|%>
  <%= course.title %> コース
  進捗度： <%= @user.is_completed_lectures.count %>/<%= course.sections.joins(:lectures).count %>
  <!-- 　joins でレクチャーを持って来れる。　　 -->
  最終更新日 <%= @checked.length >= 1 ? @checked[0].created_at.strftime('%Y/%m/%d %H:%M:%S') : '完了したレクチャーはまだありません' %>
  <!--whereとorderで持ってきているのは作成日の配列。その０番を返す。作成順に並んでいるはずなのでこれでよし  -->
  <!--   @checkedは配列で返ってくるので、上記のようにして取り出します。
  データがない場合は'完了したレクチャーはまだありません'と一旦表示してます -->
  <!--  -->

  <div class="panel-group" id="accordion">
    <% course.sections.each do |section| %>
      <div class="panel panel-default">

        <div class="panel-heading">
          <h4 class="panel-title">
            <a data-toggle="collapse" data-parent="#accordion" href="#collapse<%= i = i + 1 %>">
            <i class="fas fa-arrow-alt-circle-down">　　　</i><!-- <i class="far fa-arrow-alt-circle-up"></i> -->
            </a>
            <%= section.title %>
          </h4>
        </div>

        <!-- 上のiの計算で数字が変わっているため、ここをi+1にすると連動しなくなるので注意 -->
        <div id="collapse<%= i %>" class="panel-collapse collapse out" >
          <% section.lectures.each do |lecture|%>
            <div class="panel-body">
              <%= lecture.title %>
              <%#= @user.is_completed_lectures.joins(:lecture).created_at.strftime('%Y/%m/%d %H:%M:%S') %>
              <%#= @checked_lecture.length >= 1 ? @checked_lecture[0].created_at.strftime('%Y/%m/%d %H:%M:%S') : '完了していません' %>
            </div>
          <% end %>
        </div>

      </div>
    <% end %>
  </div>
<% end %>

